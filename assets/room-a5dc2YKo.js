import{f as C,q as M,B as o,R as e,b as T,o as b,c as w,u as D,C as K}from"./roomkit-BznSDX0x.js";import{a as N,u as k,r as R,o as v}from"./index-Crs1bENp.js";import"./roomEngine-B70HgNss.js";const B=C({__name:"room",setup(L){const{t:u}=N(),E=k(),O=sessionStorage.getItem("tuiRoom-roomInfo"),l=sessionStorage.getItem("tuiRoom-userInfo"),n=String(E.query.roomId);let I=!1,S=!1;n?O||R.push({path:"home",query:{roomId:n}}):R.push({path:"home"}),M(async()=>{const{action:t,isSeatEnabled:r,roomParam:a,hasCreated:i}=JSON.parse(O),{sdkAppId:f,userId:c,userSig:g,userName:_,avatarUrl:U}=JSON.parse(l);t==="createRoom"&&(I=!0);try{if(await o.login({sdkAppId:f,userId:c,userSig:g}),await o.setSelfInfo({userName:_,avatarUrl:U}),t==="createRoom"&&!i){await o.start(n,{roomName:`${_||c}${u("Quick Conference")}`,isSeatEnabled:r,...a});const p={action:t,roomId:n,roomName:n,isSeatEnabled:r,roomParam:a,hasCreated:!0};sessionStorage.setItem("tuiRoom-roomInfo",JSON.stringify(p))}else await o.join(n,a)}catch{sessionStorage.removeItem("tuiRoom-currentUserInfo")}}),v((t,r,a)=>{var i,f;if(S)a();else{const c=u(I?"This action causes the room to be disbanded, does it continue?":"This action causes the room to be exited, does it continue?");window.confirm(c)?(I?(i=o)==null||i.dismiss():(f=o)==null||f.leave(),a()):a(!1)}});const d=(t,r)=>{sessionStorage.removeItem("tuiRoom-roomInfo"),r&&sessionStorage.removeItem("tuiRoom-currentUserInfo"),h(t)},s=()=>d("home",!1),m=()=>d("home",!0);o.on(e.ROOM_DISMISS,s),o.on(e.ROOM_LEAVE,s),o.on(e.KICKED_OUT,s),o.on(e.ROOM_ERROR,s),o.on(e.KICKED_OFFLINE,s),o.on(e.USER_SIG_EXPIRED,m),o.on(e.USER_LOGOUT,m),T(()=>{o.off(e.ROOM_DISMISS,s),o.off(e.ROOM_LEAVE,s),o.off(e.KICKED_OUT,s),o.off(e.ROOM_ERROR,s),o.off(e.KICKED_OFFLINE,s),o.off(e.USER_SIG_EXPIRED,m),o.off(e.USER_LOGOUT,m)});const h=t=>{S=!0,R.replace({path:t})};return(t,r)=>(b(),w(D(K),{"display-mode":"permanent"}))}});export{B as default};
